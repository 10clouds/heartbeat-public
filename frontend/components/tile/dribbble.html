<link rel="import" href="tile.html">
<link rel="import" href="../socket-connection.html">

<dom-module id="hb-dribbble-tile">

  <template>
    <hb-tile id="tile">
      <value>
        <template is="dom-repeat" items="{{photos}}" indexAs="index">
          <div class="dribble-photos-item photos-item fade" style$="{{ itemStyle(item, index) }}">
          </div>
        </template>
      </value>

    </hb-tile>

    <socket-connection endpoint="dribbble" on-data="onData"></socket-connection>
  </template>

  <script>
    var dribbbleRefreshed = false;

    Polymer({
      is: 'hb-dribbble-tile',
      photos: [],
      onData: function (ev, data) {
        this.photos = data;
        this.$.tile.ping();

        // Fired only once
        if (dribbbleRefreshed === false) {
          slider.showSlides("dribble-photos-item", 0, 60 * 60 * 1000);
        }
        dribbbleRefreshed = true;
      },
      itemStyle: function (img, index) {
        if (index == 0) {
          return 'display:block; background-image:url("' + img + '")'
        }
        return 'display:none; background-image:url("' + img + '")';
      }
    });

  </script>
</dom-module>
